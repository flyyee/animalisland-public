<!DOCTYPE html>
<html>

<head>
    <title>Animal Island</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <link rel="stylesheet" href="/glowtitle.css">
    <link rel="icon" href="/icon2.png">
    <link rel="stylesheet" href="/bubbles.css">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400&display=swap" rel="stylesheet">
</head>

<body>
    <div class="container">
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>
        <div class="circle-container">
            <div class="circle"></div>
        </div>

        <span class="patterns">
            <svg width="50%" height="50%">
                <text x="50%" y="100%" text-anchor="middle">
                    ANIMAL ISLAND
                </text>
            </svg>
        </span><br>
        <!-- <br><br>
    <h1>Animal Island</h1> -->
        <input type="text" id="username" placeholder="Please enter your name"><br><br>
        <a id="room1" onclick="redirectToRoom(1)">Room 1 <span id="room1capacity">(0/5)</span></a><br><br>
        <a id="room2" onclick="redirectToRoom(2)">Room 2 <span id="room2capacity">(0/5)</span></a><br><br>
        <a id="room3" onclick="redirectToRoom(3)">Room 3 <span id="room3capacity">(0/5)</span></a><br><br>
        <a id="room4" onclick="redirectToRoom(4)">Room 4 <span id="room4capacity">(0/5)</span></a><br><br>
        <a id="room5" onclick="redirectToRoom(5)">Room 5 <span id="room5capacity">(0/5)</span></a><br><br>
    </div>
</body>

<style>
    @font-face {
        font-family: Forest;
        src: url("/Forest1.woff") format("woff"), url("/Forest1.ttf") format("truetype");
    }

    body {
        text-align: center;
        font-family: 'Open Sans', sans-serif;
        background-color: #FFE5C6;
        color: #4BC7CF;
        font-size: 20px;
    }

    body a {
        cursor: pointer;
        background-color: #695547;
        color: #42a2a8;
        font-size: 26px;
        border-radius: 5px;
        position: relative;
        padding: 7px;
        /* margin-left: 5px; */
        /* margin-right: 5px; */
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.12), 0 2px 4px rgba(0, 0, 0, 0.24);
    }

    body input {
        text-align: center;
        width: 20%;
        font-size: 20px;
        padding: 10px 6px;
        margin: 6px 0;
        border: none;
        border-bottom: 2px solid #4BC7CF;
        background-color: #cc2f2f00;
        outline: 2px solid #f8eaa100;
        color: #695547;
        /* font-weight: bold; */
    }

    body>input:focus {
        outline: 2px solid #4BC7CF;
        border-bottom: 2px solid #4BC7CF;
        background-color: #f1424200;
    }
</style>

<script>
    let serverIsOk = false
    // console.log("here")

    function makeid(length) {
        var result = '';
        var characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
        var charactersLength = characters.length;
        for (var i = 0; i < length; i++) {
            result += characters.charAt(Math.floor(Math.random() * charactersLength));
        }
        return result;
    }

    function start() {
        if (!"id" in window.localStorage || window.localStorage["id"] == null || window.localStorage["id"] == "a") {
            window.localStorage.setItem("id", makeid(16))
            // console.log(makeid(16))
        }
        if ("username" in window.localStorage && window.localStorage["id"] != null) {
            $("#username").val(window.localStorage.getItem("username"))
        }
    }

    start()

    function update() {
        for (let x = 1; x <= 5; x++) {
            let roomNumber = x
            fetch("/api/fullpoll_room" + roomNumber).then(res => res.json()).then(res => {
                if (res.success) {
                    $(`#room${roomNumber}capacity`).text("(" + res.room.currentCapacity + "/5)")
                }
            })
        }
    }

    setInterval(update, 5000)

    function redirectToRoom(roomNumber) {
        window.localStorage.setItem("username", document.getElementById("username").value)
        let hidcur = [
            'Y29jaw==', 'Yml0Y2g=',
            'ZnVjaw==', 'c2V4',
            'd2hvcmU=', 'c2x1dA==',
            'bmlnZ2E=', 'bmlnZ2Vy'
        ]
        for (let x = 0; x < hidcur.length; x++) {
            hidcur[x] = atob(hidcur[x])
        }
        let nameRegex = /^[a-zA-Z\-]+$/;
        if (window.localStorage.getItem("username").match(nameRegex) == null) {
            swal("Only characters A-Z, a-z and '-' are  acceptable.")
        } else {
            let ruc = false
            for (let cur of hidcur) {
                if (window.localStorage.getItem("username").toLowerCase().includes(cur)) {
                    ruc = true
                }
            }
            if (ruc) {
                swal("Please choose a different name.")
            } else {
                window.localStorage.setItem("roomNumber", roomNumber)
                window.location.href = "/org/room" + roomNumber;
            }
        }
    }
</script>

</html>